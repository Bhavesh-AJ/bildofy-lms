<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>AI Notes Generator</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { background:#f8f9fa; padding:40px; }
.card { max-width:650px; margin:auto; box-shadow:0 2px 8px rgba(0,0,0,0.1); }
#loader { display:none; text-align:center; }
.spinner-border { width:3rem; height:3rem; }
#success-msg { display:none; text-align:center; color:green; font-weight:600; margin-top:15px; }
</style>
</head>
<body>
<div class="card p-4">
  <h3 class="text-center mb-4">AI Notes Generator</h3>
  <form id="notesForm" action="/generate" method="post" target="downloadFrame">
    <div class="mb-3">
      <label class="form-label">Education Board</label>
      <input type="text" name="board" class="form-control" value="Karnataka PU Board" required>
    </div>
    <div class="mb-3">
      <label class="form-label">Grade</label>
      <select name="grade" class="form-select" required>
        <option>9</option><option>10</option><option>11</option><option>12</option>
      </select>
    </div>
    <div class="mb-3">
      <label class="form-label">Subject</label>
      <select id="subject" name="subject" class="form-select" required onchange="updateChapters()">
        {% for subj in subjects %}
        <option value="{{ subj }}">{{ subj }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="mb-3">
      <label class="form-label">Chapter</label>
      <select id="chapter" name="chapter" class="form-select" required></select>
    </div>
    <div class="mb-3">
      <label class="form-label">Difficulty Level</label>
      <select name="difficulty" class="form-select" required>
        <option value="easy">Easy</option>
        <option value="medium">Medium</option>
        <option value="hard">Hard</option>
      </select>
    </div>
    <button type="submit" class="btn btn-primary w-100">Generate Notes</button>
  </form>

  <div id="loader" class="mt-4">
    <div class="spinner-border text-primary" role="status"></div>
    <p class="mt-2">Generating your notes... Please wait</p>
  </div>
  <div id="success-msg">Notes generated successfully!</div>
</div>

<iframe name="downloadFrame" style="display:none;"></iframe>

<script>
const chapters = {{ chapters|tojson }};
function updateChapters(){
  const subj=document.getElementById("subject").value;
  const chapterSelect=document.getElementById("chapter");
  chapterSelect.innerHTML="";
  if(chapters[subj]){
    chapters[subj].forEach(ch=>{
      const opt=document.createElement("option");
      opt.value=ch; opt.text=ch;
      chapterSelect.appendChild(opt);
    });
  }
}
updateChapters();

const form=document.getElementById('notesForm');
form.addEventListener('submit',()=>{
  document.getElementById('loader').style.display='block';
  document.getElementById('success-msg').style.display='none';
});

// detect when file download completes
const frame=document.querySelector("iframe[name='downloadFrame']");
frame.addEventListener('load',()=>{
  document.getElementById('loader').style.display='none';
  document.getElementById('success-msg').style.display='block';
});
</script>
</body>
</html>
